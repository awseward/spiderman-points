<h1>Slash Command</h1>

<div class="centerer">
  <form id="devtools-slash-command-form" >
    TODO: Clean this junk up
    <ul class="devtools-list">
      <li>
        <label for="text"><%= @slash_command %></label>
        <input type="text" id="text" name="text" width="2000" />
      </li>
      <li>
        <label for="command">command</label>
        <input class="extra_info" id="command" name="command" value="<%= @slash_command %>" />
      </li>
      <li>
        <label for="response_url">response_url</label>
        <input class="extra_info" id="response_url" name="response_url" value="<%= @response_url %>" />
      i</li>
      <li>
        <label for="team_id">team_id</label>
        <input class="extra_info" id="team_id" name="team_id" value="<%= @team_id %>" />
      </li>
      <li>
        <label for="team_id">user_id</label>
        <input class="extra_info" id="user_id" name="user_id" value="<%= @user_id %>" />
      </li>
    </ul>
    <button type="submit">Submit</button>
  </form>
</div>

<div class="pre-container">
  <pre id="devtools-slash-command-output">Output will show up here...</pre>
</div>

<style>
  .pre-container {
    margin: 0 auto;
    width: 1200px;
  }

  #devtools-slash-command-form {
    font-size: 20pt;
    text-align: left;
  }

  input#text {
    width: 500px;
    padding: 10px;
    font-size: 16pt;
  }

  input.extra_info {
    width: 500px;
    margin-top: 10;
    padding: 8px;
    font-size: 14pt;
    color: #666;
    font-weight: 100;
  }

  #devtools-slash-command-output {
    width: 1200px;
    min-height: 300px;
    margin-top: 200px;
    white-space: pre;
    text-align: left;
    background-color: #333;
    overflow: auto;
    padding: 20px;
    font-size: 14pt;
  }
</style>

<script>
  // Adapted from https://web.archive.org/web/20200411011502/https://developer.mozilla.org/en-US/docs/Learn/Forms/Sending_forms_through_JavaScript#Using_FormData_bound_to_a_form_element
  window.addEventListener("load", function () {
    function sendData() {
      const XHR = new XMLHttpRequest();
      // Bind the FormData object and the form element
      const FD = new FormData(form);
      // Define what happens on successful data submission
      XHR.addEventListener("load", function(event) {
        output.innerText = event.target.responseText;
      });
      // Define what happens in case of error
      XHR.addEventListener("error", function( event ) {
        alert('Oops! Something went wrong.');
      });
      // Set up our request
      XHR.open("POST", "/slack/slash_command");
      // The data sent is what the user provided in the form
      XHR.send(FD);
    }

    // Access the form element...
    const form = document.getElementById("devtools-slash-command-form");
    const output = document.getElementById("devtools-slash-command-output");

    // ...and take over its submit event.
    form.addEventListener("submit", function (event) {
      event.preventDefault();

      sendData();
    });
  });
</script>
